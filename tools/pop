#!/bin/bash
# Pipe Network PoP Node Management Tools - Main entry script
# This script provides a unified command-line interface for managing Pipe Network nodes.

# Determine script location for reliable sourcing
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
ROOT_DIR="$( dirname "$SCRIPT_DIR" )"

# Installation paths
INSTALL_DIR="/opt/pipe-pop"
CONFIG_DIR="${INSTALL_DIR}/config"
CONFIG_FILE="${CONFIG_DIR}/config.json"
LOCAL_CONFIG_FILE="./config.json"

# Export necessary paths for other scripts
export SCRIPT_DIR
export ROOT_DIR
export INSTALL_DIR
export CONFIG_DIR
export CONFIG_FILE
export LOCAL_CONFIG_FILE

# Source command parser
if [[ -f "${ROOT_DIR}/src/core/command.sh" ]]; then
  source "${ROOT_DIR}/src/core/command.sh"
else
  echo -e "\033[0;31mERROR: Command parser not found!\033[0m" >&2
  echo "Expected at: ${ROOT_DIR}/src/core/command.sh" >&2
  exit 1
fi

# Validate environment
validate_environment

# Parse command line arguments and execute appropriate action
parse_command "$@"
exit $?
